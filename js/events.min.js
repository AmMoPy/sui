import{elements}from"./elements.min.js";import{state,saveState}from"./state.min.js";import{playPauseHandler,nextHandler,prevHandler}from"./playback.min.js";import{handleFileUpload,togglePlaylistVisibility,handleSelectAll,handleDeleteSelected,playItem,toggleSelection}from"./playlist.min.js";import{initializeSortButton,cycleSortOrder,cycleSortOrderReverse}from"./sorting.min.js";function initializeEventListeners(){elements.playPauseBtn.addEventListener("click",playPauseHandler);elements.prevBtn.addEventListener("click",prevHandler);elements.nextBtn.addEventListener("click",nextHandler);window.addEventListener("keydown",(function(e){if(e.key==="ArrowRight"||e.key==="MediaTrackNext"){e.preventDefault();nextHandler()}else if(e.key==="ArrowLeft"||e.key==="MediaTrackPrevious"){e.preventDefault();prevHandler()}else if(e.key===" "||e.key==="MediaPlayPause"){e.preventDefault();playPauseHandler()}}));if("mediaSession"in navigator){navigator.mediaSession.setActionHandler("previoustrack",prevHandler);navigator.mediaSession.setActionHandler("nexttrack",nextHandler);navigator.mediaSession.setActionHandler("play",(()=>{state.audio.play();elements.playPauseBtn.textContent="⏸";elements.playPauseBtn.setAttribute("aria-label","Pause")}));navigator.mediaSession.setActionHandler("pause",(()=>{state.audio.pause();elements.playPauseBtn.textContent="▶";elements.playPauseBtn.setAttribute("aria-label","Play")}))}elements.uploadBtn.addEventListener("click",(()=>elements.fileUpload.click()));elements.fileUpload.addEventListener("change",handleFileUpload);elements.selectAllBtn.addEventListener("click",handleSelectAll);elements.deleteSelectedBtn.addEventListener("click",handleDeleteSelected);elements.togglePlaylistBtn.addEventListener("click",togglePlaylistVisibility);elements.sortControlBtn.addEventListener("click",(function(e){if(e.shiftKey){cycleSortOrderReverse(e.target)}else{cycleSortOrder(e.target)}}));elements.sortControlBtn.addEventListener("keydown",(function(e){if(e.shiftKey&&e.key==="Enter"){e.preventDefault();cycleSortOrderReverse(e.target)}}));initializeSortButton(elements.sortControlBtn);initializePlaylistEvents();initializeGestures()}function initializeGestures(){const hammer=new Hammer.Manager(document.body,{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_HORIZONTAL}],[Hammer.Tap,{event:"singletap",taps:1,interval:250,time:250,threshold:9}]]});hammer.get("swipe").recognizeWith("singletap");hammer.get("singletap").requireFailure("swipe");hammer.on("singletap",(e=>{if(!e.target.closest("button, input, a, li")){playPauseHandler()}}));hammer.on("swiperight",nextHandler);hammer.on("swipeleft",prevHandler)}function initializePlaylistEvents(){elements.playList.addEventListener("mousedown",(function(e){const li=e.target.closest("li");if(!li)return;const index=parseInt(li.dataset.index);if(e.ctrlKey||e.metaKey||e.shiftKey){e.preventDefault()}}));elements.playList.addEventListener("click",(function(e){const li=e.target.closest("li");if(!li)return;const index=parseInt(li.dataset.index);if(e.button!==0)return;if(e.ctrlKey||e.metaKey||e.shiftKey){toggleSelection(index)}else{playItem(index)}}));let touchTimer;let touchStartTime;elements.playList.addEventListener("touchstart",(function(e){const li=e.target.closest("li");if(!li)return;const index=parseInt(li.dataset.index);touchStartTime=Date.now();touchTimer=setTimeout((()=>{toggleSelection(index);li.classList.add("long-press")}),500)}),{passive:true});elements.playList.addEventListener("touchend",(function(e){const li=e.target.closest("li");if(!li)return;clearTimeout(touchTimer);const index=parseInt(li.dataset.index);if(!li.classList.contains("long-press")){if(Date.now()-touchStartTime<200){e.preventDefault();playItem(index)}}li.classList.remove("long-press")}),{passive:false})}export{initializeEventListeners};