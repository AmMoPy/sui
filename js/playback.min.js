import{elements}from"./elements.min.js";import{state}from"./state.min.js";import{showStatusMessage,speakText,renderPlayList}from"./ui.min.js";import{clearSelections}from"./playlist.min.js";function playPauseHandler(){if(state.items.length===0){showStatusMessage("No audio files in playlist","info");speakText("Empty");return}if(state.audio.paused){if(!state.audio.src||state.audio.src===document.location.href){if(state.items.length>0){loadItem(0)}else{showStatusMessage("No audio files to play","info")}return}const playPromise=state.audio.play();elements.playPauseBtn.textContent="⏸";playPromise.catch((error=>{console.error("Playback failed:",error);elements.playPauseBtn.textContent="▶";showStatusMessage("Could not play audio","error")}))}else{state.audio.pause();elements.playPauseBtn.textContent="▶"}}function nextHandler(){const newIndex=state.currentIndex+1;if(newIndex<state.items.length){loadItem(newIndex)}else{speakText("End of playlist reached")}}function prevHandler(){const newIndex=state.currentIndex-1;if(newIndex>=0){loadItem(newIndex)}else{speakText("Beginning of playlist")}}function loadItem(index){if(index<0||index>=state.items.length){console.warn("Invalid item index:",index);showStatusMessage("Invalid item selected","error");return}clearSelections();if(state.currentAudioUrl){URL.revokeObjectURL(state.currentAudioUrl);state.currentAudioUrl=null}state.audio.pause();state.currentIndex=index;const item=state.items[index];if(!item){console.error("Item not found at index:",index);showStatusMessage("Playback item not found","error");return}try{if(item.path){state.audio.src=item.path}else if(item.data){const blob=new Blob([item.data],{type:"audio/mp3"});state.currentAudioUrl=URL.createObjectURL(blob);state.audio.src=state.currentAudioUrl}else{throw new Error("Invalid playlist item: missing path or data")}renderPlayList();const playPromise=state.audio.play();elements.playPauseBtn.textContent="⏸";playPromise.catch((error=>{console.error("Playback failed:",error);elements.playPauseBtn.textContent="▶";showStatusMessage("Could not play audio","error")}));state.selectedItems.add(index);speakItemName(item.name);renderPlayList()}catch(error){console.error("Playback failed:",error);elements.playPauseBtn.textContent="▶";showStatusMessage("Playback error: "+error.message,"error")}}function handleSongEnd(){elements.playPauseBtn.textContent="▶";if(state.currentIndex<state.items.length-1){setTimeout((()=>loadItem(state.currentIndex+1)),500)}}function speakItemName(name){speakText(name)}function updateMediaSession(){if("mediaSession"in navigator){navigator.mediaSession.metadata=new MediaMetadata({title:state.items[state.currentIndex]?.name||"Unknown Track",artist:"SUI",artwork:[{src:"assets/icons/arrow.png",sizes:"512x512",type:"image/png"}]})}}export{playPauseHandler,nextHandler,prevHandler,loadItem,handleSongEnd,speakItemName,updateMediaSession};